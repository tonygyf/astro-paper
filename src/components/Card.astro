---

import type { CollectionEntry } from "astro:content";
import { getPath } from "@/utils/getPath";
import Datetime from "./Datetime.astro";
import LinkButton from "./LinkButton.astro";
import IconGitHub from "@/assets/icons/IconGitHub.svg";

interface BlogPostProps extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
}

interface ProjectCardProps {
  href: string;
  title: string;
  secHed: string;
  img?: string;
  variant?: "h2" | "h3";
}

type Props = BlogPostProps | ProjectCardProps;

const props = Astro.props;

let title: string;
let description: string;
let href: string;
let pubDatetime: Date | undefined;
let modDatetime: Date | undefined;
let timezone: string | undefined;
let img: string | undefined;
let variant: "h2" | "h3" = "h3";
let viewTransitionName: string;

if ("data" in props) {
  // It's a blog post
  const { data, id, variant: blogVariant } = props;
  title = data.title;
  description = data.description;
  href = `/posts/${getPath(id)}`; // ✅ 不要用 data.file
  pubDatetime = data.pubDatetime;
  modDatetime = data.modDatetime ?? undefined;
  timezone = data.timezone;
  variant = blogVariant || "h3";
  viewTransitionName = id;
} else {
  // It's a project card
  const { href: projectHref, title: projectTitle, secHed, img: projectImg, variant: projectVariant } = props;
  title = projectTitle;
  description = secHed;
  href = projectHref;
  img = projectImg;
  variant = projectVariant || "h3";
  viewTransitionName = title;
}

const headerProps = {
  style: { viewTransitionName: viewTransitionName },
  className: "text-lg font-medium hover:underline decoration-dashed underline-offset-4",
};

---

<li class="my-6">
  <div class="flex justify-between items-center">
    <a href={href} class="group inline-block hover:text-accent">
      {
        variant === "h2" ? (
          <h2 {...headerProps}>{title}</h2>
        ) : (
          <h3 {...headerProps}>{title}</h3>
        )
      }
    </a>
    {!("data" in props) && href && (
      <LinkButton
        href={href}
        class="p-2 hover:rotate-6 sm:p-1"
        title="GitHub Link"
      >
        <IconGitHub class="inline-block size-6 scale-125 fill-transparent stroke-current stroke-2 opacity-90 group-hover:fill-transparent sm:scale-110" />
        <span class="sr-only">GitHub Link</span>
      </LinkButton>
    )}
  </div>
  {img && <img src={img} alt={title} class="w-full h-48 object-cover my-2" />}
  {pubDatetime && <Datetime {pubDatetime} {modDatetime} {timezone} />}
  <p>{description}</p>
</li>
