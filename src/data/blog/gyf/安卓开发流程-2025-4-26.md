---
title: å®‰å“å¼€å‘æµç¨‹-2025-4-26
author: éƒ­å²©å³°
description: è¯¦ç»†æ¢³ç†å®‰å“é¡¹ç›®æ¨¡å—åŠŸèƒ½å¢åŠ çš„æ ‡å‡†æµç¨‹ï¼Œæ¶µç›– MVVM æ¶æ„ã€Fragment æ³¨å†Œã€èœå•é…ç½®ã€é¡¹ç›®ç»“æ„ç­‰å®æ“æ­¥éª¤ã€‚
pubDatetime: 2025-04-26T00:00:00Z
slug: android-dev-flow-2025-4-26
tags:
  - Android
  - å¼€å‘æµç¨‹
  - MVVM
  - Fragment
  - é¡¹ç›®ç»“æ„
ogImage: ""
featured: false
draft: false
---

# æ­£å¸¸å¢åŠ æ¨¡å—åŠŸèƒ½çš„æ­¥éª¤ï¼ˆé’ˆå¯¹äºmvvmçš„appï¼Œä»¥è°·æ­Œæ¨¡æ¿ä¸ºä¾‹ï¼‰

------

## âœ… æ­¥éª¤ä¸€ï¼šç¡®è®¤ä½ çš„é˜…è¯»å™¨é¡¹ç›®çš„ç»“æ„

ä½ çš„é¡¹ç›®ç°åœ¨åº”è¯¥æ˜¯è¿™ç§ç»“æ„ï¼š

```
com.example.myapplication1
â”œâ”€â”€ MainActivity
â”œâ”€â”€ ui
â”‚   â”œâ”€â”€ reader
â”‚   â”‚   â”œâ”€â”€ ReaderFragment
â”‚   â”‚   â”œâ”€â”€ ReaderViewModel
â”‚   â””â”€â”€ (å…¶ä»–...)
â”œâ”€â”€ data
â”‚   â”œâ”€â”€ Book.java
â”‚   â”œâ”€â”€ Chapter.java
â”‚   â””â”€â”€ ...
â””â”€â”€ utils
    â””â”€â”€ TxtFileParser.java
```

**GalleryFragment**ã€**SlideshowFragment**ä¸€èˆ¬åœ¨ï¼š

```
com.example.myapplication1.ui.gallery.GalleryFragment
com.example.myapplication1.ui.slideshow.SlideshowFragment
```

------

## âœ… æ­¥éª¤äºŒï¼šå¤åˆ¶ Gallery å’Œ Slideshow åˆ°ä½ çš„é¡¹ç›®

å¦‚æœä½ çš„é˜…è¯»å™¨é¡¹ç›®æ²¡æœ‰ `gallery` å’Œ `slideshow` ç›®å½•ï¼Œ
 **ç›´æ¥å¤åˆ¶**ï¼ˆæˆ–è€…æ‰‹åŠ¨æ–°å»ºï¼‰è¿™ä¸¤ä¸ª `Fragment` å’Œå®ƒä»¬çš„å¸ƒå±€æ–‡ä»¶ã€‚

æ¯”å¦‚ï¼š

- `ui/gallery/GalleryFragment.java`
- `res/layout/fragment_gallery.xml`
- `ui/slideshow/SlideshowFragment.java`
- `res/layout/fragment_slideshow.xml`

------

## âœ… æ­¥éª¤ä¸‰ï¼šåœ¨ `navigation_graph.xml` ä¸­æ³¨å†Œä¸¤ä¸ª Fragment

å¦‚æœä½ é¡¹ç›®æ˜¯ç”¨ **Navigation Component**ï¼ˆå¯¼èˆªå›¾ï¼‰ï¼Œ
 é‚£ä¹ˆæ‰“å¼€ä½ çš„ `res/navigation/nav_graph.xml`ï¼Œ
 æ‰‹åŠ¨åŠ ä¸Š `GalleryFragment` å’Œ `SlideshowFragment`ï¼Œåƒè¿™æ ·ï¼š

```xml
<fragment
    android:id="@+id/nav_gallery"
    android:name="com.example.myapplication1.ui.gallery.GalleryFragment"
    android:label="Gallery"
    tools:layout="@layout/fragment_gallery" />
    
<fragment
    android:id="@+id/nav_slideshow"
    android:name="com.example.myapplication1.ui.slideshow.SlideshowFragment"
    android:label="Slideshow"
    tools:layout="@layout/fragment_slideshow" />
```

âœ… è¿™æ ·å¯¼èˆªå›¾é‡Œé¢å°±æœ‰äº† Gallery å’Œ Slideshowã€‚

------

## âœ… æ­¥éª¤å››ï¼šåœ¨ `drawer_menu.xml` åŠ å…¥èœå•é¡¹ï¼ˆè®©ä¾§è¾¹æ èƒ½è·³è½¬ï¼‰

æ‰“å¼€ä½ çš„ `res/menu/activity_main_drawer.xml`ï¼Œ
 åŠ ä¸Šå¯¹åº”çš„èœå•æŒ‰é’®ï¼Œæ¯”å¦‚ï¼š

```xml
<item
    android:id="@+id/nav_gallery"
    android:icon="@drawable/ic_menu_gallery"
    android:title="Gallery" />
<item
    android:id="@+id/nav_slideshow"
    android:icon="@drawable/ic_menu_slideshow"
    android:title="Slideshow" />
```

âœ… è¿™æ ·ï¼Œç‚¹å¼€æŠ½å±‰å°±èƒ½çœ‹åˆ°è¿™ä¸¤ä¸ªæŒ‰é’®ã€‚

------

## âœ… æ­¥éª¤äº”ï¼šåœ¨ `MainActivity` é‡Œè‡ªåŠ¨å¤„ç†è·³è½¬ï¼ˆé€šå¸¸å·²ç»æœ‰äº†ï¼‰

å¦‚æœä½ çš„ `MainActivity` æ˜¯æ ‡å‡†æ¨¡æ¿ï¼ˆç”¨ `NavigationUI` è‡ªåŠ¨ç»‘å®šèœå•ï¼‰ï¼Œ
 é€šå¸¸åƒè¿™æ ·ï¼š

```java
NavController navController = Navigation.findNavController(this, R.id.nav_host_fragment_content_main);
NavigationUI.setupActionBarWithNavController(this, navController, appBarConfiguration);
NavigationUI.setupWithNavController(binding.navView, navController);
```

é‚£ä¹ˆåªè¦ä½ åœ¨ `navigation_graph.xml` å’Œ `menu` é‡Œé¢é…ç½®å¥½äº†ï¼Œ
 ç‚¹å‡»èœå•é¡¹å°±ä¼š**è‡ªåŠ¨è·³è½¬**åˆ° `GalleryFragment`ã€`SlideshowFragment`äº†ã€‚

âœ… æ— éœ€é¢å¤–ä»£ç ï¼

------

## æ€»ç»“ ğŸ”¥

| è¦åšçš„äº‹ | æè¿°                                                   |
| -------- | ------------------------------------------------------ |
| 1        | å¤åˆ¶ `GalleryFragment`ã€`SlideshowFragment` ä»£ç å’Œå¸ƒå±€ |
| 2        | æŠŠ Fragment æ³¨å†Œåˆ° `nav_graph.xml`                     |
| 3        | åœ¨ `drawer_menu.xml` åŠ èœå•æŒ‰é’®                        |
| 4        | ç¡®è®¤ `MainActivity` å·²ç»‘å®š NavController               |

æå®šä¹‹åï¼Œä½ çš„é˜…è¯»å™¨é¡¹ç›®å°±æ‹¥æœ‰ï¼š**é˜…è¯»åŠŸèƒ½ + ç”»å»Š + å¹»ç¯ç‰‡**ï¼Œè€Œä¸”åˆ‡æ¢è‡ªç„¶é¡ºæ»‘ï¼

------

#  **å®‰å“å¼€å‘çš„ç»„æˆ** å’Œ **MVVMæ€ä¹ˆç”¨**ã€‚



------

## ğŸ“± å®‰å“ App å¼€å‘çš„åŸºæœ¬ç»„æˆ

ä¸€ä¸ªå®‰å“ Appï¼Œæœ€åŸºç¡€çš„ç»„æˆéƒ¨åˆ†æ˜¯ï¼š

| ç»„ä»¶           | ä½œç”¨                            | ä¸¾ä¾‹                           |
| -------------- | ------------------------------- | ------------------------------ |
| **Activity**   | ä¸€ä¸ªå±å¹•                        | ç™»å½•ç•Œé¢ã€ä¸»é¡µ                 |
| **Fragment**   | Activity çš„å°æ¨¡å—ï¼Œé¡µé¢çš„ä¸€éƒ¨åˆ† | åˆ—è¡¨ã€è¯¦æƒ…é¡µ                   |
| **View**       | UI ç»„ä»¶                         | Buttonã€TextViewã€RecyclerView |
| **ViewModel**  | ç®¡ç†ç•Œé¢æ•°æ®ï¼ˆMVVMçš„V+VMæ¡¥æ¢ï¼‰  | ä¿å­˜è¾“å…¥çš„å†…å®¹ã€åŠ è½½ç½‘ç»œæ•°æ®   |
| **LiveData**   | å¯è§‚å¯Ÿçš„æ•°æ®                    | ç›‘å¬æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ›´æ–°ç•Œé¢     |
| **Repository** | æ•°æ®ä»“åº“ï¼ˆè´Ÿè´£å–æ•°æ®ï¼‰          | è¯»æ•°æ®åº“ã€ç½‘ç»œè¯·æ±‚             |
| **Room**       | å®‰å“å†…ç½®æ•°æ®åº“ï¼ˆSQLiteå°è£…ï¼‰    | å­˜ç”¨æˆ·ä¿¡æ¯ã€å†å²è®°å½•           |
| **Navigation** | é¡µé¢è·³è½¬ç»„ä»¶                    | ä»ç™»å½•é¡µè·³åˆ°é¦–é¡µ               |

**è¿˜æœ‰åˆ«çš„ï¼Œæ¯”å¦‚ Serviceã€BroadcastReceiverï¼Œä½†å¹³æ—¶ç”¨å¾—æœ€å¤šçš„å°±æ˜¯ä¸Šé¢è¿™äº›ã€‚**

------

## ğŸ“ ä»€ä¹ˆæ˜¯ MVVMï¼Ÿä¸ºä»€ä¹ˆç”¨å®ƒï¼Ÿ

**MVVM** =

- **Modelï¼ˆæ¨¡å‹ï¼‰**ï¼šæ•°æ®ï¼Œæ¯”å¦‚ä¹¦æœ¬ã€ç« èŠ‚ã€‚
- **Viewï¼ˆç•Œé¢ï¼‰**ï¼šå±•ç¤ºUIï¼Œæ¯”å¦‚TextViewã€RecyclerViewã€‚
- **ViewModelï¼ˆè§†å›¾æ¨¡å‹ï¼‰**ï¼šè¿æ¥Modelå’ŒViewï¼Œä¸­é—´å±‚ï¼Œè´Ÿè´£æä¾›æ•°æ®ç»™ç•Œé¢ã€‚

ğŸ”µ ä¸ºä»€ä¹ˆç”¨ MVVMï¼Ÿ

- è®©**æ•°æ®å’Œç•Œé¢**åˆ†å¼€å†™ã€‚
- ç•Œé¢å˜åŒ–**è‡ªåŠ¨æ›´æ–°**ï¼Œä¸ç”¨æ‰‹åŠ¨åˆ·æ–°ã€‚
- ä»£ç **æ›´å¹²å‡€**ï¼Œ**æ›´å¥½ç»´æŠ¤**ï¼Œå°¤å…¶æ˜¯é¡¹ç›®å˜å¤§æ—¶ã€‚

------

## ğŸ› ï¸ MVVMåœ¨å®‰å“æ€ä¹ˆä½¿ç”¨ï¼Ÿ

è¶…ç®€å•ï¼Œæˆ‘åˆ†æˆ 3 æ­¥å‘Šè¯‰ä½ ï¼š

------

### ç¬¬1æ­¥ï¼šViewå±‚ï¼ˆæ¯”å¦‚ Fragment / Activityï¼‰

- åªç®¡**å±•ç¤ºç•Œé¢**ã€**ç›‘å¬ç”¨æˆ·æ“ä½œ**ã€‚
- ä¸å†™å¤ªå¤šé€»è¾‘ï¼Œé€»è¾‘äº¤ç»™ViewModelã€‚

```java
// ç»‘å®šViewModel
ReaderViewModel viewModel = new ViewModelProvider(this).get(ReaderViewModel.class);

// è§‚å¯Ÿæ•°æ®
viewModel.getCurrentBook().observe(getViewLifecycleOwner(), book -> {
    textViewTitle.setText(book.getTitle());
});
```

------

### ç¬¬2æ­¥ï¼šViewModelå±‚ï¼ˆReaderViewModelï¼‰

- è´Ÿè´£æ‹¿æ•°æ®ã€å¤„ç†æ•°æ®ï¼Œæä¾›ç»™Viewã€‚
- ç”¨ `LiveData` åŒ…è£…æ•°æ®ï¼Œè®©ç•Œé¢è‡ªåŠ¨æ„ŸçŸ¥å˜åŒ–ã€‚

```java
public class ReaderViewModel extends AndroidViewModel {
    private final MutableLiveData<Book> currentBook = new MutableLiveData<>();

    public LiveData<Book> getCurrentBook() {
        return currentBook;
    }

    public void loadBook(String uriString) {
        // ä»æ•°æ®åº“æˆ–æ–‡ä»¶ä¸­åŠ è½½
        Book book = new Book("æˆ‘çš„ä¹¦", uriString);
        currentBook.postValue(book); // è‡ªåŠ¨é€šçŸ¥ç•Œé¢
    }
}
```

------

### ç¬¬3æ­¥ï¼šModelå±‚ï¼ˆæ•°æ®å±‚ï¼‰

- çœŸæ­£çš„æ•°æ®ï¼Œæ¯”å¦‚æ•°æ®åº“ã€æ–‡ä»¶ã€ç½‘ç»œã€‚
- æ¯”å¦‚ Book.javaã€Chapter.java

```java
@Entity
public class Book {
    @PrimaryKey(autoGenerate = true)
    private int id;
    private String title;
    private String uri;
    // getter / setter...
}
```

------

## âœ¨ ä¸€ä¸ªå°æ€»ç»“ï¼šMVVMæ•´ä½“æµåŠ¨

```
[ç”¨æˆ·æ“ä½œç•Œé¢] --> é€šçŸ¥ ViewModel
[ViewModel] --> æ‹¿åˆ°æ•°æ® --> ç”¨LiveDataé€šçŸ¥ View
[View] --> è‡ªåŠ¨æ›´æ–°UI
```

ä¸€æ¡é“¾è·¯å°±è¿™ä¹ˆç®€å•ï¼

------

## ğŸŒŸ å°ä¸¾ä¾‹ï¼ˆä½ çš„é¡¹ç›®é‡Œçš„åº”ç”¨ï¼‰

æ¯”å¦‚ä½ åœ¨é˜…è¯»å™¨é¡¹ç›®é‡Œï¼š

| å±‚        | ä¾‹å­                                                |
| --------- | --------------------------------------------------- |
| View      | `ReaderFragment` å±•ç¤ºç« èŠ‚æ ‡é¢˜ã€é˜…è¯»å†…å®¹             |
| ViewModel | `ReaderViewModel` è´Ÿè´£åŠ è½½ Bookã€ç« èŠ‚åˆ—è¡¨ã€è®°å½•è¿›åº¦ |
| Model     | `Book`, `Chapter`, è¿˜æœ‰ `BookDao`ï¼ˆæ•°æ®åº“æ“ä½œï¼‰     |

âœ… **ä½ ReaderFragmentç”¨ViewModelæ‹¿æ•°æ®ï¼Œæ˜¾ç¤ºåˆ°ç•Œé¢ä¸Šã€‚**
 âœ… **æ•°æ®åº“ç”¨Roomç®¡ç†Bookå’ŒChapterï¼Œä¸ç›´æ¥æ“ä½œæ•°æ®åº“ã€‚**

------

# ğŸš€ å°å½©è›‹ï¼šä¸ºä»€ä¹ˆç”¨ LiveDataï¼Ÿ

å› ä¸ºå®ƒæ„ŸçŸ¥ç”Ÿå‘½å‘¨æœŸï¼ˆActivity/Fragmentæ¶ˆå¤±å°±ä¸å†æ›´æ–°äº†ï¼‰ï¼Œ å¯ä»¥é˜²æ­¢**å†…å­˜æ³„æ¼**ï¼Œæ¯”ç›´æ¥å†™å›è°ƒæ¥å£å®‰å…¨å¾—å¤šï¼

------

è¦ä¸è¦æˆ‘é¡ºä¾¿ç»™ä½ ç”»ä¸€ä¸ª**ReaderFragment** + **ReaderViewModel** çš„MVVMæµç¨‹å›¾ï¼Ÿ
 çœ‹ä¸€çœ¼å°±æ˜ç™½æ€ä¹ˆä¸²èµ·æ¥çš„ï¼ğŸ“ˆ

è¦çš„è¯å‘Šè¯‰æˆ‘ï¼âš¡ ï¼ˆæˆ‘è¿˜èƒ½æ•™ä½ æ€ä¹ˆä¸€é”®ç”¨ DataBindingï¼Œè®©ç•Œé¢ç›´æ¥ç»‘å®šæ•°æ®ï¼Œä¸ç”¨ findViewByIdï¼Œè¶…é…·çš„ï½ï¼‰è¦ç»§ç»­å—ï¼ŸğŸ‘€